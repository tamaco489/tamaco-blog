# バックエンド ディレクトリ構成と開発ルール

## 現行ディレクトリ構成

以下は `backend` 配下の詳細な構成です。実際の構成と差異が生じた場合は、このドキュメントを更新してください。

```text
backend/
├─ api/
│  ├─ article/
│  │  ├─ Makefile
│  │  ├─ build/
│  │  ├─ cmd/
│  │  │  └─ main.go
│  │  ├─ go.mod
│  │  ├─ internal/
│  │  │  ├─ configuration/
│  │  │  ├─ controller/
│  │  │  ├─ domain/
│  │  │  ├─ gen/
│  │  │  ├─ library/
│  │  │  ├─ repository/
│  │  │  └─ usecase/
│  │  ├─ scripts/
│  │  │  └─ localstack/
│  │  │     └─ rds_secret_manager.sh
│  │  └─ spec/
│  └─ compose.yaml
```

## 各ディレクトリの詳細な役割

### `api/` - API サービス群

- マイクロサービス形式で各 API を分離配置
- 各 API サービスは独立したモジュールとして管理

### `api/article/` - 記事管理 API サービス

- 記事の CRUD 操作を提供する Go アプリケーション
- クリーンアーキテクチャに基づく設計

#### `cmd/` - エントリーポイント

- **main.go**: アプリケーションのエントリーポイント
- 依存関係の注入とサーバー起動処理

#### `internal/` - 内部パッケージ（Clean Architecture）

- Go の internal パッケージ規約に従い、外部からのアクセスを制限

#### `internal/configuration/` - 設定管理

- 環境変数、設定ファイルの読み込み
- データベース接続設定
- AWS サービス設定

#### `internal/controller/` - プレゼンテーション層

- HTTP ハンドラー、ルーティング
- リクエスト/レスポンスの変換
- 入力値検証

#### `internal/domain/` - ドメイン層

- ビジネスロジック、エンティティ
- ドメインサービス
- インターフェース定義

#### `internal/gen/` - 自動生成コード

- OpenAPI からの自動生成コード
- データベーススキーマからの自動生成

#### `internal/library/` - 共通ライブラリ

- 共通ユーティリティ関数
- 外部ライブラリのラッパー
- ログ処理、エラーハンドリング

#### `internal/repository/` - データアクセス層

- データベースアクセス実装
- 外部 API 連携
- キャッシュ処理

#### `internal/usecase/` - アプリケーション層

- ビジネスユースケースの実装
- ドメイン層と repository 層の調整
- トランザクション管理

#### `build/` - ビルド成果物

- コンパイル済みバイナリ
- Docker イメージビルド用

#### `scripts/` - 運用スクリプト

- デプロイメントスクリプト
- 開発環境セットアップ

#### `scripts/localstack/` - ローカル開発環境

- LocalStack（AWS サービスローカル実行）設定
- 開発用データベース初期化

#### `spec/` - API 仕様書

- OpenAPI/Swagger 仕様ファイル
- API ドキュメント

## 開発ルール

### アーキテクチャ設計原則

- **Clean Architecture**: レイヤー分離による保守性向上
- **DDD**: ドメイン駆動設計によるビジネスロジック集約
- **SOLID 原則**: 拡張性・保守性を重視した設計

### ファイル命名規則

- **snake_case**: ファイル名、ディレクトリ名
- **PascalCase**: 構造体名、インターフェース名
- **camelCase**: 関数名、変数名、定数

### パッケージ設計原則

- **internal パッケージ**: 外部アクセス制限の活用
- **インターフェース分離**: 依存関係の逆転
- **単一責任**: 各パッケージは明確な責任を持つ

### コード品質管理

- **Go 標準**: gofmt、golint、go vet の活用
- **テストカバレッジ**: 80% 以上を目標
- **エラーハンドリング**: 適切なエラー処理の実装

### セキュリティ対策

- **入力検証**: すべての入力値の検証
- **認証・認可**: JWT トークンベース認証
- **ログ管理**: セキュリティイベントのログ記録

## 変更時のガイドライン

- **ドキュメント更新**: ディレクトリ／ファイルを追加・削除した場合は、本ドキュメントのツリーを更新
- **事前承認**: アーキテクチャ変更は設計レビューと承認が必要
- **依存関係管理**: ライブラリの追加やバージョン変更は、セキュリティ・パフォーマンス影響を評価

## 技術前提

- **言語**: Go 1.24+
- **フレームワーク**: Gin（HTTP ルーター）
- **データベース**: PostgreSQL（Supabase）
- **クラウド**: AWS Lambda + API Gateway
- **コンテナ**: Docker
- **CI/CD**: GitHub Actions
